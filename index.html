<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Admin | Clandestino Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0f0f0f;
  color:#fff;
  font-family:Arial, sans-serif;
  padding:20px;
}
.panel{max-width:1000px;margin:auto}
h1{color:#e63946;margin-bottom:10px}

.card{
  background:#1f1f1f;
  padding:20px;
  border-radius:14px;
  margin-bottom:20px;
}

input{
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:15px;
}

.agenda{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:14px;
}

.turno{
  background:#2e2e2e;
  padding:14px;
  border-radius:12px;
}

.turno .fecha{
  font-weight:bold;
  color:#e63946;
  margin-bottom:4px;
}

.turno .tipo{
  font-size:13px;
  opacity:.8;
}

.turno button{
  margin-top:10px;
  width:100%;
  border:none;
  padding:8px;
  border-radius:8px;
  background:#e63946;
  color:#fff;
  cursor:pointer;
}
</style>
</head>

<body>

<script>
const PASSWORD = "clan-destino";
if(prompt("ContraseÃ±a de administrador") !== PASSWORD){
  alert("Acceso denegado");
  location.href = "index.html";
}
</script>

<div class="panel">
<h1>Panel Admin Â· BarberÃ­a + Tattoo</h1>

<div class="card">
<label>ðŸ“… Filtrar por fecha (opcional)</label><br><br>
<input type="date" id="fecha">
</div>

<div class="card">
<h3>Agenda de turnos</h3>
<div class="agenda" id="agenda"></div>
</div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDwNU_IreA5-LLCb8MKNsh_tk2hNFnWwSI",
  authDomain: "clandestino-turnos.firebaseapp.com",
  projectId: "clandestino-turnos",
  storageBucket: "clandestino-turnos.firebasestorage.app",
  messagingSenderId: "549861699412",
  appId: "1:549861699412:web:87a0a598b9e9474b9aa2c1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
</script>

<script>
const agenda = document.getElementById("agenda");
const fechaInput = document.getElementById("fecha");

fechaInput.addEventListener("change", cargar);

function cargar(){
  agenda.innerHTML = "<p>Cargando turnos...</p>";

  let query = db.collection("turnos");
  if(fechaInput.value){
    query = query.where("fecha", "==", fechaInput.value);
  }

  query
    .orderBy("fecha")
    .orderBy("hora")
    .get()
    .then(snapshot => {
      agenda.innerHTML = "";

      if(snapshot.empty){
        agenda.innerHTML = "<p>No hay turnos</p>";
        return;
      }

      snapshot.forEach(doc => {
        const t = doc.data();
        const id = doc.id;

        const profesional = t.barbero || t.tatuador || "â€”";
        const tipo = t.barbero ? "ðŸ’ˆ BarberÃ­a" : "ðŸ–‹ Tattoo";

        const duracion =
          t.servicio === "10x10" ? "4 hs" :
          t.servicio === "5x5" ? "3 hs" :
          "";

        const d = document.createElement("div");
        d.className = "turno";
        d.innerHTML = `
          <div class="fecha">${t.fecha} Â· ${t.hora}</div>
          <div class="tipo">${tipo}</div>
          <strong>${profesional}</strong><br>
          Cliente: ${t.nombre}<br>
          Servicio: ${t.servicio} ${duracion}<br>
          <button onclick="borrar('${id}')">Cancelar turno</button>
        `;
        agenda.appendChild(d);
      });
    });
}

function borrar(id){
  if(!confirm("Â¿Cancelar este turno?")) return;
  db.collection("turnos").doc(id).delete().then(cargar);
}

cargar();
</script>

</body>
</html>
